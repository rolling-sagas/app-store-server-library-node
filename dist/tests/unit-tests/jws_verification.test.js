"use strict";
// Copyright (c) 2023 Apple Inc. Licensed under MIT License.
Object.defineProperty(exports, "__esModule", { value: true });
const assert = require("assert");
const crypto_1 = require("crypto");
const jws_verification_1 = require("../../jws_verification");
const Environment_1 = require("../../models/Environment");
const util_1 = require("../util");
const ROOT_CA_BASE64_ENCODED = "MIIBgjCCASmgAwIBAgIJALUc5ALiH5pbMAoGCCqGSM49BAMDMDYxCzAJBgNVBAYTAlVTMRMwEQYDVQQIDApDYWxpZm9ybmlhMRIwEAYDVQQHDAlDdXBlcnRpbm8wHhcNMjMwMTA1MjEzMDIyWhcNMzMwMTAyMjEzMDIyWjA2MQswCQYDVQQGEwJVUzETMBEGA1UECAwKQ2FsaWZvcm5pYTESMBAGA1UEBwwJQ3VwZXJ0aW5vMFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEc+/Bl+gospo6tf9Z7io5tdKdrlN1YdVnqEhEDXDShzdAJPQijamXIMHf8xWWTa1zgoYTxOKpbuJtDplz1XriTaMgMB4wDAYDVR0TBAUwAwEB/zAOBgNVHQ8BAf8EBAMCAQYwCgYIKoZIzj0EAwMDRwAwRAIgemWQXnMAdTad2JDJWng9U4uBBL5mA7WI05H7oH7c6iQCIHiRqMjNfzUAyiu9h6rOU/K+iTR0I/3Y/NSWsXHX+acc";
const INTERMEDIATE_CA_BASE64_ENCODED = "MIIBnzCCAUWgAwIBAgIBCzAKBggqhkjOPQQDAzA2MQswCQYDVQQGEwJVUzETMBEGA1UECAwKQ2FsaWZvcm5pYTESMBAGA1UEBwwJQ3VwZXJ0aW5vMB4XDTIzMDEwNTIxMzEwNVoXDTMzMDEwMTIxMzEwNVowRTELMAkGA1UEBhMCVVMxCzAJBgNVBAgMAkNBMRIwEAYDVQQHDAlDdXBlcnRpbm8xFTATBgNVBAoMDEludGVybWVkaWF0ZTBZMBMGByqGSM49AgEGCCqGSM49AwEHA0IABBUN5V9rKjfRiMAIojEA0Av5Mp0oF+O0cL4gzrTF178inUHugj7Et46NrkQ7hKgMVnjogq45Q1rMs+cMHVNILWqjNTAzMA8GA1UdEwQIMAYBAf8CAQAwDgYDVR0PAQH/BAQDAgEGMBAGCiqGSIb3Y2QGAgEEAgUAMAoGCCqGSM49BAMDA0gAMEUCIQCmsIKYs41ullssHX4rVveUT0Z7Is5/hLK1lFPTtun3hAIgc2+2RG5+gNcFVcs+XJeEl4GZ+ojl3ROOmll+ye7dynQ=";
const LEAF_CERT_BASE64_ENCODED = "MIIBoDCCAUagAwIBAgIBDDAKBggqhkjOPQQDAzBFMQswCQYDVQQGEwJVUzELMAkGA1UECAwCQ0ExEjAQBgNVBAcMCUN1cGVydGlubzEVMBMGA1UECgwMSW50ZXJtZWRpYXRlMB4XDTIzMDEwNTIxMzEzNFoXDTMzMDEwMTIxMzEzNFowPTELMAkGA1UEBhMCVVMxCzAJBgNVBAgMAkNBMRIwEAYDVQQHDAlDdXBlcnRpbm8xDTALBgNVBAoMBExlYWYwWTATBgcqhkjOPQIBBggqhkjOPQMBBwNCAATitYHEaYVuc8g9AjTOwErMvGyPykPa+puvTI8hJTHZZDLGas2qX1+ErxgQTJgVXv76nmLhhRJH+j25AiAI8iGsoy8wLTAJBgNVHRMEAjAAMA4GA1UdDwEB/wQEAwIHgDAQBgoqhkiG92NkBgsBBAIFADAKBggqhkjOPQQDAwNIADBFAiBX4c+T0Fp5nJ5QRClRfu5PSByRvNPtuaTsk0vPB3WAIAIhANgaauAj/YP9s0AkEhyJhxQO/6Q2zouZ+H1CIOehnMzQ";
const INTERMEDIATE_CA_INVALID_OID_BASE64_ENCODED = "MIIBnjCCAUWgAwIBAgIBDTAKBggqhkjOPQQDAzA2MQswCQYDVQQGEwJVUzETMBEGA1UECAwKQ2FsaWZvcm5pYTESMBAGA1UEBwwJQ3VwZXJ0aW5vMB4XDTIzMDEwNTIxMzYxNFoXDTMzMDEwMTIxMzYxNFowRTELMAkGA1UEBhMCVVMxCzAJBgNVBAgMAkNBMRIwEAYDVQQHDAlDdXBlcnRpbm8xFTATBgNVBAoMDEludGVybWVkaWF0ZTBZMBMGByqGSM49AgEGCCqGSM49AwEHA0IABBUN5V9rKjfRiMAIojEA0Av5Mp0oF+O0cL4gzrTF178inUHugj7Et46NrkQ7hKgMVnjogq45Q1rMs+cMHVNILWqjNTAzMA8GA1UdEwQIMAYBAf8CAQAwDgYDVR0PAQH/BAQDAgEGMBAGCiqGSIb3Y2QGAgIEAgUAMAoGCCqGSM49BAMDA0cAMEQCIFROtTE+RQpKxNXETFsf7Mc0h+5IAsxxo/X6oCC/c33qAiAmC5rn5yCOOEjTY4R1H1QcQVh+eUwCl13NbQxWCuwxxA==";
const LEAF_CERT_FOR_INTERMEDIATE_CA_INVALID_OID_BASE64_ENCODED = "MIIBnzCCAUagAwIBAgIBDjAKBggqhkjOPQQDAzBFMQswCQYDVQQGEwJVUzELMAkGA1UECAwCQ0ExEjAQBgNVBAcMCUN1cGVydGlubzEVMBMGA1UECgwMSW50ZXJtZWRpYXRlMB4XDTIzMDEwNTIxMzY1OFoXDTMzMDEwMTIxMzY1OFowPTELMAkGA1UEBhMCVVMxCzAJBgNVBAgMAkNBMRIwEAYDVQQHDAlDdXBlcnRpbm8xDTALBgNVBAoMBExlYWYwWTATBgcqhkjOPQIBBggqhkjOPQMBBwNCAATitYHEaYVuc8g9AjTOwErMvGyPykPa+puvTI8hJTHZZDLGas2qX1+ErxgQTJgVXv76nmLhhRJH+j25AiAI8iGsoy8wLTAJBgNVHRMEAjAAMA4GA1UdDwEB/wQEAwIHgDAQBgoqhkiG92NkBgsBBAIFADAKBggqhkjOPQQDAwNHADBEAiAUAs+gzYOsEXDwQquvHYbcVymyNqDtGw9BnUFp2YLuuAIgXxQ3Ie9YU0cMqkeaFd+lyo0asv9eyzk6stwjeIeOtTU=";
const LEAF_CERT_INVALID_OID_BASE64_ENCODED = "MIIBoDCCAUagAwIBAgIBDzAKBggqhkjOPQQDAzBFMQswCQYDVQQGEwJVUzELMAkGA1UECAwCQ0ExEjAQBgNVBAcMCUN1cGVydGlubzEVMBMGA1UECgwMSW50ZXJtZWRpYXRlMB4XDTIzMDEwNTIxMzczMVoXDTMzMDEwMTIxMzczMVowPTELMAkGA1UEBhMCVVMxCzAJBgNVBAgMAkNBMRIwEAYDVQQHDAlDdXBlcnRpbm8xDTALBgNVBAoMBExlYWYwWTATBgcqhkjOPQIBBggqhkjOPQMBBwNCAATitYHEaYVuc8g9AjTOwErMvGyPykPa+puvTI8hJTHZZDLGas2qX1+ErxgQTJgVXv76nmLhhRJH+j25AiAI8iGsoy8wLTAJBgNVHRMEAjAAMA4GA1UdDwEB/wQEAwIHgDAQBgoqhkiG92NkBgsCBAIFADAKBggqhkjOPQQDAwNIADBFAiAb+7S3i//bSGy7skJY9+D4VgcQLKFeYfIMSrUCmdrFqwIhAIMVwzD1RrxPRtJyiOCXLyibIvwcY+VS73HYfk0O9lgz";
const LEAF_CERT_PUBLIC_KEY_BASE64_ENCODED = "MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAE4rWBxGmFbnPIPQI0zsBKzLxsj8pD2vqbr0yPISUx2WQyxmrNql9fhK8YEEyYFV7++p5i4YUSR/o9uQIgCPIhrA==";
const REAL_APPLE_ROOT_BASE64_ENCODED = "MIICQzCCAcmgAwIBAgIILcX8iNLFS5UwCgYIKoZIzj0EAwMwZzEbMBkGA1UEAwwSQXBwbGUgUm9vdCBDQSAtIEczMSYwJAYDVQQLDB1BcHBsZSBDZXJ0aWZpY2F0aW9uIEF1dGhvcml0eTETMBEGA1UECgwKQXBwbGUgSW5jLjELMAkGA1UEBhMCVVMwHhcNMTQwNDMwMTgxOTA2WhcNMzkwNDMwMTgxOTA2WjBnMRswGQYDVQQDDBJBcHBsZSBSb290IENBIC0gRzMxJjAkBgNVBAsMHUFwcGxlIENlcnRpZmljYXRpb24gQXV0aG9yaXR5MRMwEQYDVQQKDApBcHBsZSBJbmMuMQswCQYDVQQGEwJVUzB2MBAGByqGSM49AgEGBSuBBAAiA2IABJjpLz1AcqTtkyJygRMc3RCV8cWjTnHcFBbZDuWmBSp3ZHtfTjjTuxxEtX/1H7YyYl3J6YRbTzBPEVoA/VhYDKX1DyxNB0cTddqXl5dvMVztK517IDvYuVTZXpmkOlEKMaNCMEAwHQYDVR0OBBYEFLuw3qFYM4iapIqZ3r6966/ayySrMA8GA1UdEwEB/wQFMAMBAf8wDgYDVR0PAQH/BAQDAgEGMAoGCCqGSM49BAMDA2gAMGUCMQCD6cHEFl4aXTQY2e3v9GwOAEZLuN+yRhHFD/3meoyhpmvOwgPUnPWTxnS4at+qIxUCMG1mihDK1A3UT82NQz60imOlM27jbdoXt2QfyFMm+YhidDkLF1vLUagM6BgD56KyKA==";
const REAL_APPLE_INTERMEDIATE_BASE64_ENCODED = "MIIDFjCCApygAwIBAgIUIsGhRwp0c2nvU4YSycafPTjzbNcwCgYIKoZIzj0EAwMwZzEbMBkGA1UEAwwSQXBwbGUgUm9vdCBDQSAtIEczMSYwJAYDVQQLDB1BcHBsZSBDZXJ0aWZpY2F0aW9uIEF1dGhvcml0eTETMBEGA1UECgwKQXBwbGUgSW5jLjELMAkGA1UEBhMCVVMwHhcNMjEwMzE3MjAzNzEwWhcNMzYwMzE5MDAwMDAwWjB1MUQwQgYDVQQDDDtBcHBsZSBXb3JsZHdpZGUgRGV2ZWxvcGVyIFJlbGF0aW9ucyBDZXJ0aWZpY2F0aW9uIEF1dGhvcml0eTELMAkGA1UECwwCRzYxEzARBgNVBAoMCkFwcGxlIEluYy4xCzAJBgNVBAYTAlVTMHYwEAYHKoZIzj0CAQYFK4EEACIDYgAEbsQKC94PrlWmZXnXgtxzdVJL8T0SGYngDRGpngn3N6PT8JMEb7FDi4bBmPhCnZ3/sq6PF/cGcKXWsL5vOteRhyJ45x3ASP7cOB+aao90fcpxSv/EZFbniAbNgZGhIhpIo4H6MIH3MBIGA1UdEwEB/wQIMAYBAf8CAQAwHwYDVR0jBBgwFoAUu7DeoVgziJqkipnevr3rr9rLJKswRgYIKwYBBQUHAQEEOjA4MDYGCCsGAQUFBzABhipodHRwOi8vb2NzcC5hcHBsZS5jb20vb2NzcDAzLWFwcGxlcm9vdGNhZzMwNwYDVR0fBDAwLjAsoCqgKIYmaHR0cDovL2NybC5hcHBsZS5jb20vYXBwbGVyb290Y2FnMy5jcmwwHQYDVR0OBBYEFD8vlCNR01DJmig97bB85c+lkGKZMA4GA1UdDwEB/wQEAwIBBjAQBgoqhkiG92NkBgIBBAIFADAKBggqhkjOPQQDAwNoADBlAjBAXhSq5IyKogMCPtw490BaB677CaEGJXufQB/EqZGd6CSjiCtOnuMTbXVXmxxcxfkCMQDTSPxarZXvNrkxU3TkUMI33yzvFVVRT4wxWJC994OsdcZ4+RGNsYDyR5gmdr0nDGg=";
const REAL_APPLE_SIGNING_CERTIFICATE_BASE64_ENCODED = "MIIEMDCCA7agAwIBAgIQaPoPldvpSoEH0lBrjDPv9jAKBggqhkjOPQQDAzB1MUQwQgYDVQQDDDtBcHBsZSBXb3JsZHdpZGUgRGV2ZWxvcGVyIFJlbGF0aW9ucyBDZXJ0aWZpY2F0aW9uIEF1dGhvcml0eTELMAkGA1UECwwCRzYxEzARBgNVBAoMCkFwcGxlIEluYy4xCzAJBgNVBAYTAlVTMB4XDTIxMDgyNTAyNTAzNFoXDTIzMDkyNDAyNTAzM1owgZIxQDA+BgNVBAMMN1Byb2QgRUNDIE1hYyBBcHAgU3RvcmUgYW5kIGlUdW5lcyBTdG9yZSBSZWNlaXB0IFNpZ25pbmcxLDAqBgNVBAsMI0FwcGxlIFdvcmxkd2lkZSBEZXZlbG9wZXIgUmVsYXRpb25zMRMwEQYDVQQKDApBcHBsZSBJbmMuMQswCQYDVQQGEwJVUzBZMBMGByqGSM49AgEGCCqGSM49AwEHA0IABOoTcaPcpeipNL9eQ06tCu7pUcwdCXdN8vGqaUjd58Z8tLxiUC0dBeA+euMYggh1/5iAk+FMxUFmA2a1r4aCZ8SjggIIMIICBDAMBgNVHRMBAf8EAjAAMB8GA1UdIwQYMBaAFD8vlCNR01DJmig97bB85c+lkGKZMHAGCCsGAQUFBwEBBGQwYjAtBggrBgEFBQcwAoYhaHR0cDovL2NlcnRzLmFwcGxlLmNvbS93d2RyZzYuZGVyMDEGCCsGAQUFBzABhiVodHRwOi8vb2NzcC5hcHBsZS5jb20vb2NzcDAzLXd3ZHJnNjAyMIIBHgYDVR0gBIIBFTCCAREwggENBgoqhkiG92NkBQYBMIH+MIHDBggrBgEFBQcCAjCBtgyBs1JlbGlhbmNlIG9uIHRoaXMgY2VydGlmaWNhdGUgYnkgYW55IHBhcnR5IGFzc3VtZXMgYWNjZXB0YW5jZSBvZiB0aGUgdGhlbiBhcHBsaWNhYmxlIHN0YW5kYXJkIHRlcm1zIGFuZCBjb25kaXRpb25zIG9mIHVzZSwgY2VydGlmaWNhdGUgcG9saWN5IGFuZCBjZXJ0aWZpY2F0aW9uIHByYWN0aWNlIHN0YXRlbWVudHMuMDYGCCsGAQUFBwIBFipodHRwOi8vd3d3LmFwcGxlLmNvbS9jZXJ0aWZpY2F0ZWF1dGhvcml0eS8wHQYDVR0OBBYEFCOCmMBq//1L5imvVmqX1oCYeqrMMA4GA1UdDwEB/wQEAwIHgDAQBgoqhkiG92NkBgsBBAIFADAKBggqhkjOPQQDAwNoADBlAjEAl4JB9GJHixP2nuibyU1k3wri5psGIxPME05sFKq7hQuzvbeyBu82FozzxmbzpogoAjBLSFl0dZWIYl2ejPV+Di5fBnKPu8mymBQtoE/H2bES0qAs8bNueU3CBjjh1lwnDsI=";
const EFFECTIVE_DATE = new Date(1681312846000); // April 2023
class SignedJWTVerifierTest extends jws_verification_1.SignedDataVerifier {
    constructor() {
        super(...arguments);
        this.effectiveDate = EFFECTIVE_DATE;
    }
    async testVerifyCertificateChain(trustedRoots, leaf, intermediate) {
        return await this.verifyCertificateChain(trustedRoots, new crypto_1.X509Certificate(Buffer.from(leaf, 'base64')), new crypto_1.X509Certificate(Buffer.from(intermediate, 'base64')), this.effectiveDate);
    }
    getRootCertificates() {
        return this.rootCertificates;
    }
}
describe("Chain Verification Checks", () => {
    it('should validate a chain without OCSP', async () => {
        const verifier = new SignedJWTVerifierTest([Buffer.from(ROOT_CA_BASE64_ENCODED, 'base64')], false, Environment_1.Environment.PRODUCTION, "com.example", 1234);
        const publicKey = await verifier.testVerifyCertificateChain(verifier.getRootCertificates(), LEAF_CERT_BASE64_ENCODED, INTERMEDIATE_CA_BASE64_ENCODED);
        expect(Buffer.from(LEAF_CERT_PUBLIC_KEY_BASE64_ENCODED, 'base64')).toMatchObject(publicKey.export({
            type: 'spki',
            format: 'der'
        }));
    });
    it('should fail to validate a chain with an invalid intermediate OID', async () => {
        const verifier = new SignedJWTVerifierTest([Buffer.from(ROOT_CA_BASE64_ENCODED, 'base64')], false, Environment_1.Environment.PRODUCTION, "com.example", 1234);
        try {
            await verifier.testVerifyCertificateChain(verifier.getRootCertificates(), LEAF_CERT_FOR_INTERMEDIATE_CA_INVALID_OID_BASE64_ENCODED, INTERMEDIATE_CA_INVALID_OID_BASE64_ENCODED);
            assert(false);
        }
        catch (e) {
            expect(e).toBeInstanceOf(jws_verification_1.VerificationException);
            expect(e.status).toEqual(jws_verification_1.VerificationStatus.VERIFICATION_FAILURE);
        }
    });
    it('should fail to validate a chain with an invalid leaf OID', async () => {
        const verifier = new SignedJWTVerifierTest([Buffer.from(ROOT_CA_BASE64_ENCODED, 'base64')], false, Environment_1.Environment.PRODUCTION, "com.example", 1234);
        try {
            await verifier.testVerifyCertificateChain(verifier.getRootCertificates(), LEAF_CERT_INVALID_OID_BASE64_ENCODED, INTERMEDIATE_CA_BASE64_ENCODED);
            assert(false);
        }
        catch (e) {
            expect(e).toBeInstanceOf(jws_verification_1.VerificationException);
            expect(e.status).toEqual(jws_verification_1.VerificationStatus.VERIFICATION_FAILURE);
        }
    });
    it('should fail to validate a chain with empty root certificate array', async () => {
        const verifier = new SignedJWTVerifierTest([], false, Environment_1.Environment.PRODUCTION, "com.example", 1234);
        try {
            await verifier.testVerifyCertificateChain(verifier.getRootCertificates(), LEAF_CERT_BASE64_ENCODED, INTERMEDIATE_CA_BASE64_ENCODED);
            assert(false);
        }
        catch (e) {
            expect(e).toBeInstanceOf(jws_verification_1.VerificationException);
            expect(e.status).toEqual(jws_verification_1.VerificationStatus.VERIFICATION_FAILURE);
        }
    });
    it('should fail to validate a chain with an expired chain', async () => {
        const verifier = new SignedJWTVerifierTest([Buffer.from(ROOT_CA_BASE64_ENCODED, 'base64')], false, Environment_1.Environment.PRODUCTION, "com.example", 1234);
        verifier.effectiveDate = new Date(2280946846000);
        try {
            await verifier.testVerifyCertificateChain(verifier.getRootCertificates(), LEAF_CERT_BASE64_ENCODED, INTERMEDIATE_CA_BASE64_ENCODED);
            assert(false);
        }
        catch (e) {
            expect(e).toBeInstanceOf(jws_verification_1.VerificationException);
            expect(e.status).toEqual(jws_verification_1.VerificationStatus.INVALID_CERTIFICATE);
        }
    });
    it('should validate a real chain with OCSP', async () => {
        const verifier = new SignedJWTVerifierTest([Buffer.from(REAL_APPLE_ROOT_BASE64_ENCODED, 'base64')], true, Environment_1.Environment.PRODUCTION, "com.example", 1234);
        await verifier.testVerifyCertificateChain(verifier.getRootCertificates(), REAL_APPLE_SIGNING_CERTIFICATE_BASE64_ENCODED, REAL_APPLE_INTERMEDIATE_BASE64_ENCODED);
    });
    it('should fail to validate a chain with mismatched root certificates', async () => {
        const verifier = new SignedJWTVerifierTest([Buffer.from(REAL_APPLE_ROOT_BASE64_ENCODED, 'base64')], false, Environment_1.Environment.PRODUCTION, "com.example", 1234);
        try {
            await verifier.testVerifyCertificateChain(verifier.getRootCertificates(), LEAF_CERT_BASE64_ENCODED, INTERMEDIATE_CA_BASE64_ENCODED);
            assert(false);
        }
        catch (e) {
            expect(e).toBeInstanceOf(jws_verification_1.VerificationException);
            expect(e.status).toEqual(jws_verification_1.VerificationStatus.VERIFICATION_FAILURE);
            return;
        }
    });
    it('should fail to validate a chain with invalid root certificates', async () => {
        try {
            const verifier = new SignedJWTVerifierTest([Buffer.from("abc", "utf-8")], false, Environment_1.Environment.PRODUCTION, "com.example", 1234);
            await verifier.testVerifyCertificateChain(verifier.getRootCertificates(), LEAF_CERT_BASE64_ENCODED, INTERMEDIATE_CA_BASE64_ENCODED);
        }
        catch (e) {
            return;
        }
        assert(false);
    });
});
describe("Decoding checks", () => {
    it('should fail to verify with a missing x5c header', async () => {
        const verifier = (0, util_1.getSignedPayloadVerifierWithDefaultAppAppleId)(Environment_1.Environment.PRODUCTION, "com.example");
        try {
            const missingX5CHeaderClaim = (0, util_1.readFile)('tests/resources/mock_signed_data/missingX5CHeaderClaim');
            await verifier.verifyAndDecodeNotification(missingX5CHeaderClaim);
            assert(false);
        }
        catch (e) {
            expect(e).toBeInstanceOf(jws_verification_1.VerificationException);
            expect(e.status).toEqual(jws_verification_1.VerificationStatus.INVALID_CERTIFICATE);
        }
    });
    it('should fail to verify with an invalid bundle id', async () => {
        const verifier = (0, util_1.getSignedPayloadVerifierWithDefaultAppAppleId)(Environment_1.Environment.SANDBOX, "com.example");
        try {
            const wrongBundelId = (0, util_1.readFile)('tests/resources/mock_signed_data/wrongBundleId');
            await verifier.verifyAndDecodeNotification(wrongBundelId);
            assert(false);
        }
        catch (e) {
            expect(e).toBeInstanceOf(jws_verification_1.VerificationException);
            expect(e.status).toEqual(jws_verification_1.VerificationStatus.INVALID_APP_IDENTIFIER);
        }
    });
    it('should fail to verify with an invalid bundle id for transaction', async () => {
        try {
            const verifier = (0, util_1.getSignedPayloadVerifierWithDefaultAppAppleId)(Environment_1.Environment.SANDBOX, "com.example.x");
            const transactionInfo = (0, util_1.readFile)('tests/resources/mock_signed_data/transactionInfo');
            await verifier.verifyAndDecodeTransaction(transactionInfo);
            assert(false);
        }
        catch (e) {
            expect(e).toBeInstanceOf(jws_verification_1.VerificationException);
            expect(e.status).toEqual(jws_verification_1.VerificationStatus.INVALID_APP_IDENTIFIER);
        }
    });
    it('should fail to verify with an invalid environment', async () => {
        try {
            const verifier = (0, util_1.getSignedPayloadVerifierWithDefaultAppAppleId)(Environment_1.Environment.PRODUCTION, "com.example");
            const testNotification = (0, util_1.readFile)('tests/resources/mock_signed_data/testNotification');
            const notification = await verifier.verifyAndDecodeNotification(testNotification);
            await verifier.verifyAndDecodeNotification(testNotification);
            assert(false);
        }
        catch (e) {
            expect(e).toBeInstanceOf(jws_verification_1.VerificationException);
            expect(e.status).toEqual(jws_verification_1.VerificationStatus.INVALID_ENVIRONMENT);
        }
    });
    it('should fail to verify with a malformed JWT with too many parts', async () => {
        const verifier = (0, util_1.getSignedPayloadVerifierWithDefaultAppAppleId)(Environment_1.Environment.SANDBOX, "com.example");
        try {
            await verifier.verifyAndDecodeNotification("a.b.c.d");
            assert(false);
        }
        catch (e) {
            expect(e).toBeInstanceOf(jws_verification_1.VerificationException);
            expect(e.status).toEqual(jws_verification_1.VerificationStatus.VERIFICATION_FAILURE);
        }
    });
    it('should fail to verify with a malformed JWT', async () => {
        const verifier = (0, util_1.getSignedPayloadVerifierWithDefaultAppAppleId)(Environment_1.Environment.SANDBOX, "com.example");
        try {
            await verifier.verifyAndDecodeNotification("a.b.c");
            assert(false);
        }
        catch (e) {
            expect(e).toBeInstanceOf(jws_verification_1.VerificationException);
            expect(e.status).toEqual(jws_verification_1.VerificationStatus.VERIFICATION_FAILURE);
        }
    });
    it('should verify and decode a valid notification', async () => {
        const verifier = (0, util_1.getSignedPayloadVerifierWithDefaultAppAppleId)(Environment_1.Environment.SANDBOX, "com.example");
        const testNotification = (0, util_1.readFile)('tests/resources/mock_signed_data/testNotification');
        const notification = await verifier.verifyAndDecodeNotification(testNotification);
        expect(notification.notificationType).toEqual("TEST");
    });
    it('should verify and decode a valid renewal info', async () => {
        const verifier = (0, util_1.getSignedPayloadVerifierWithDefaultAppAppleId)(Environment_1.Environment.SANDBOX, "com.example");
        const renewalInfo = (0, util_1.readFile)('tests/resources/mock_signed_data/renewalInfo');
        const notification = await verifier.verifyAndDecodeRenewalInfo(renewalInfo);
        expect(notification.environment).toEqual(Environment_1.Environment.SANDBOX);
    });
    it('should verify and decode a valid transaction info', async () => {
        const verifier = (0, util_1.getSignedPayloadVerifierWithDefaultAppAppleId)(Environment_1.Environment.SANDBOX, "com.example");
        const transactionInfo = (0, util_1.readFile)('tests/resources/mock_signed_data/transactionInfo');
        const notification = await verifier.verifyAndDecodeRenewalInfo(transactionInfo);
        expect(notification.environment).toEqual(Environment_1.Environment.SANDBOX);
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiandzX3ZlcmlmaWNhdGlvbi50ZXN0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vdGVzdHMvdW5pdC10ZXN0cy9qd3NfdmVyaWZpY2F0aW9uLnRlc3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLDREQUE0RDs7QUFFNUQsaUNBQWtDO0FBQ2xDLG1DQUFvRDtBQUNwRCw2REFBdUc7QUFDdkcsMERBQXVEO0FBQ3ZELGtDQUFtSDtBQUVuSCxNQUFNLHNCQUFzQixHQUFHLDBnQkFBMGdCLENBQUM7QUFDMWlCLE1BQU0sOEJBQThCLEdBQUcsa2pCQUFrakIsQ0FBQztBQUMxbEIsTUFBTSx3QkFBd0IsR0FBRyxrakJBQWtqQixDQUFDO0FBRXBsQixNQUFNLDBDQUEwQyxHQUFHLGtqQkFBa2pCLENBQUM7QUFDdG1CLE1BQU0sd0RBQXdELEdBQUcsa2pCQUFrakIsQ0FBQztBQUNwbkIsTUFBTSxvQ0FBb0MsR0FBRyxrakJBQWtqQixDQUFDO0FBRWhtQixNQUFNLG1DQUFtQyxHQUFHLDhIQUE4SCxDQUFDO0FBRTNLLE1BQU0sOEJBQThCLEdBQUcsOHdCQUE4d0IsQ0FBQztBQUN0ekIsTUFBTSxzQ0FBc0MsR0FBRyxzaUNBQXNpQyxDQUFDO0FBQ3RsQyxNQUFNLDZDQUE2QyxHQUFHLDg1Q0FBODVDLENBQUM7QUFFcjlDLE1BQU0sY0FBYyxHQUFHLElBQUksSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUMsYUFBYTtBQUM3RCxNQUFNLHFCQUFzQixTQUFRLHFDQUFrQjtJQUF0RDs7UUFDSSxrQkFBYSxHQUFHLGNBQWMsQ0FBQTtJQVFsQyxDQUFDO0lBUEcsS0FBSyxDQUFDLDBCQUEwQixDQUFDLFlBQStCLEVBQUUsSUFBWSxFQUFFLFlBQW9CO1FBQ2hHLE9BQU8sTUFBTSxJQUFJLENBQUMsc0JBQXNCLENBQUMsWUFBWSxFQUFFLElBQUksd0JBQWUsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxRQUFRLENBQUMs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QU0sQ0FBQyxDQUFBO0lBQ3pELENBQUMsQ0FBQyxDQUFBO0lBRUYsRUFBRSxDQUFDLCtDQUErQyxFQUFFLEtBQUssSUFBSSxFQUFFO1FBQzNELE1BQU0sUUFBUSxHQUFFLElBQUEsb0RBQTZDLEVBQUMseUJBQVcsQ0FBQyxPQUFPLEVBQUUsYUFBYSxDQUFDLENBQUE7UUFFakcsTUFBTSxXQUFXLEdBQUcsSUFBQSxlQUFRLEVBQUMsOENBQThDLENBQUMsQ0FBQTtRQUM1RSxNQUFNLFlBQVksR0FBRyxNQUFNLFFBQVEsQ0FBQywwQkFBMEIsQ0FBQyxXQUFXLENBQUMsQ0FBQTtRQUMzRSxNQUFNLENBQUMsWUFBWSxDQUFDLFdBQVcsQ0FBQyxDQUFDLE9BQU8sQ0FBQyx5QkFBVyxDQUFDLE9BQU8sQ0FBQyxDQUFBO0lBQ2pFLENBQUMsQ0FBQyxDQUFBO0lBRUYsRUFBRSxDQUFDLG1EQUFtRCxFQUFFLEtBQUssSUFBSSxFQUFFO1FBQy9ELE1BQU0sUUFBUSxHQUFHLElBQUEsb0RBQTZDLEVBQUMseUJBQVcsQ0FBQyxPQUFPLEVBQUUsYUFBYSxDQUFDLENBQUE7UUFFbEcsTUFBTSxlQUFlLEdBQUcsSUFBQSxlQUFRLEVBQUMsa0RBQWtELENBQUMsQ0FBQTtRQUNwRixNQUFNLFlBQVksR0FBRyxNQUFNLFFBQVEsQ0FBQywwQkFBMEIsQ0FBQyxlQUFlLENBQUMsQ0FBQTtRQUMvRSxNQUFNLENBQUMsWUFBWSxDQUFDLFdBQVcsQ0FBQyxDQUFDLE9BQU8sQ0FBQyx5QkFBVyxDQUFDLE9BQU8sQ0FBQyxDQUFBO0lBQ2pFLENBQUMsQ0FBQyxDQUFBO0FBQ04sQ0FBQyxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgKGMpIDIwMjMgQXBwbGUgSW5jLiBMaWNlbnNlZCB1bmRlciBNSVQgTGljZW5zZS5cblxuaW1wb3J0IGFzc2VydCA9IHJlcXVpcmUoXCJhc3NlcnRcIik7XG5pbXBvcnQgeyBLZXlPYmplY3QsIFg1MDlDZXJ0aWZpY2F0ZSB9IGZyb20gXCJjcnlwdG9cIjtcbmltcG9ydCB7IFNpZ25lZERhdGFWZXJpZmllciwgVmVyaWZpY2F0aW9uRXhjZXB0aW9uLCBWZXJpZmljYXRpb25TdGF0dXMgfSBmcm9tIFwiLi4vLi4vandzX3ZlcmlmaWNhdGlvblwiO1xuaW1wb3J0IHsgRW52aXJvbm1lbnQgfSBmcm9tIFwiLi4vLi4vbW9kZWxzL0Vudmlyb25tZW50XCI7XG5pbXBvcnQgeyByZWFkRmlsZSwgZ2V0U2lnbmVkUGF5bG9hZFZlcmlmaWVyV2l0aERlZmF1bHRBcHBBcHBsZUlkLCBnZXREZWZhdWx0U2lnbmVkUGF5bG9hZFZlcmlmaWVyIH0gZnJvbSBcIi4uL3V0aWxcIjtcblxuY29uc3QgUk9PVF9DQV9CQVNFNjRfRU5DT0RFRCA9IFwiTUlJQmdqQ0NBU21nQXdJQkFnSUpBTFVjNUFMaUg1cGJNQW9HQ0NxR1NNNDlCQU1ETURZeEN6QUpCZ05WQkFZVEFsVlRNUk13RVFZRFZRUUlEQXBEWVd4cFptOXlibWxoTVJJd0VBWURWUVFIREFsRGRYQmxjblJwYm04d0hoY05Nak13TVRBMU1qRXpNREl5V2hjTk16TXdNVEF5TWpFek1ESXlXakEyTVFzd0NRWURWUVFHRXdKVlV6RVRNQkVHQTFVRUNBd0tRMkZzYVdadmNtNXBZVEVTTUJBR0ExVUVCd3dKUTNWd1pYSjBhVzV2TUZrd0V3WUhLb1pJemowQ0FRWUlLb1pJemowREFRY0RRZ0FFYysvQmwrZ29zcG82dGY5WjdpbzV0ZEtkcmxOMVlkVm5xRWhFRFhEU2h6ZEFKUFFpamFtWElNSGY4eFdXVGExemdvWVR4T0twYnVKdERwbHoxWHJpVGFNZ01CNHdEQVlEVlIwVEJBVXdBd0VCL3pBT0JnTlZIUThCQWY4RUJBTUNBUVl3Q2dZSUtvWkl6ajBFQXdNRFJ3QXdSQUlnZW1XUVhuTUFkVGFkMkpESlduZzlVNHVCQkw1bUE3V0kwNUg3b0g3YzZpUUNJSGlScU1qTmZ6VUF5aXU5aDZyT1UvSytpVFIwSS8zWS9OU1dzWEhYK2FjY1wiO1xuY29uc3QgSU5URVJNRURJQVRFX0NBX0JBU0U2NF9FTkNPREVEID0gXCJNSUlCbnpDQ0FVV2dBd0lCQWdJQkN6QUtCZ2dxaGtqT1BRUURBekEyTVFzd0NRWURWUVFHRXdKVlV6RVRNQkVHQTFVRUNBd0tRMkZzYVdadmNtNXBZVEVTTUJBR0ExVUVCd3dKUTNWd1pYSjBhVzV2TUI0WERUSXpNREV3TlRJeE16RXdOVm9YRFRNek1ERXdNVEl4TXpFd05Wb3dSVEVMTUFrR0ExVUVCaE1DVlZNeEN6QUpCZ05WQkFnTUFrTkJNUkl3RUFZRFZRUUhEQWxEZFhCbGNuUnBibTh4RlRBVEJnTlZCQW9NREVsdWRHVnliV1ZrYVdGMFpUQlpNQk1HQnlxR1NNNDlBZ0VHQ0NxR1NNNDlBd0VIQTBJQUJCVU41VjlyS2pmUmlNQUlvakVBMEF2NU1wMG9GK08wY0w0Z3pyVEYxNzhpblVIdWdqN0V0NDZOcmtRN2hLZ01WbmpvZ3E0NVExck1zK2NNSFZOSUxXcWpOVEF6TUE4R0ExVWRFd1FJTUFZQkFmOENBUUF3RGdZRFZSMFBBUUgvQkFRREFnRUdNQkFHQ2lxR1NJYjNZMlFHQWdFRUFnVUFNQW9HQ0NxR1NNNDlCQU1EQTBnQU1FVUNJUUNtc0lLWXM0MXVsbHNzSFg0clZ2ZVVUMFo3SXM1L2hMSzFsRlBUdHVuM2hBSWdjMisyUkc1K2dOY0ZWY3MrWEplRWw0R1orb2psM1JPT21sbCt5ZTdkeW5RPVwiO1xuY29uc3QgTEVBRl9DRVJUX0JBU0U2NF9FTkNPREVEID0gXCJNSUlCb0RDQ0FVYWdBd0lCQWdJQkREQUtCZ2dxaGtqT1BRUURBekJGTVFzd0NRWURWUVFHRXdKVlV6RUxNQWtHQTFVRUNBd0NRMEV4RWpBUUJnTlZCQWNNQ1VOMWNHVnlkR2x1YnpFVk1CTUdBMVVFQ2d3TVNXNTBaWEp0WldScFlYUmxNQjRYRFRJek1ERXdOVEl4TXpFek5Gb1hEVE16TURFd01USXhNekV6TkZvd1BURUxNQWtHQTFVRUJoTUNWVk14Q3pBSkJnTlZCQWdNQWtOQk1SSXdFQVlEVlFRSERBbERkWEJsY25ScGJtOHhEVEFMQmdOVkJBb01CRXhsWVdZd1dUQVRCZ2NxaGtqT1BRSUJCZ2dxaGtqT1BRTUJCd05DQUFUaXRZSEVhWVZ1YzhnOUFqVE93RXJNdkd5UHlrUGErcHV2VEk4aEpUSFpaRExHYXMycVgxK0VyeGdRVEpnVlh2NzZubUxoaFJKSCtqMjVBaUFJOGlHc295OHdMVEFKQmdOVkhSTUVBakFBTUE0R0ExVWREd0VCL3dRRUF3SUhnREFRQmdvcWhraUc5Mk5rQmdzQkJBSUZBREFLQmdncWhrak9QUVFEQXdOSUFEQkZBaUJYNGMrVDBGcDVuSjVRUkNsUmZ1NVBTQnlSdk5QdHVhVHNrMHZQQjNXQUlBSWhBTmdhYXVBai9ZUDlzMEFrRWh5Smh4UU8vNlEyem91WitIMUNJT2Vobk16UVwiOyAgICBcblxuY29uc3QgSU5URVJNRURJQVRFX0NBX0lOVkFMSURfT0lEX0JBU0U2NF9FTkNPREVEID0gXCJNSUlCbmpDQ0FVV2dBd0lCQWdJQkRUQUtCZ2dxaGtqT1BRUURBekEyTVFzd0NRWURWUVFHRXdKVlV6RVRNQkVHQTFVRUNBd0tRMkZzYVdadmNtNXBZVEVTTUJBR0ExVUVCd3dKUTNWd1pYSjBhVzV2TUI0WERUSXpNREV3TlRJeE16WXhORm9YRFRNek1ERXdNVEl4TXpZeE5Gb3dSVEVMTUFrR0ExVUVCaE1DVlZNeEN6QUpCZ05WQkFnTUFrTkJNUkl3RUFZRFZRUUhEQWxEZFhCbGNuUnBibTh4RlRBVEJnTlZCQW9NREVsdWRHVnliV1ZrYVdGMFpUQlpNQk1HQnlxR1NNNDlBZ0VHQ0NxR1NNNDlBd0VIQTBJQUJCVU41VjlyS2pmUmlNQUlvakVBMEF2NU1wMG9GK08wY0w0Z3pyVEYxNzhpblVIdWdqN0V0NDZOcmtRN2hLZ01WbmpvZ3E0NVExck1zK2NNSFZOSUxXcWpOVEF6TUE4R0ExVWRFd1FJTUFZQkFmOENBUUF3RGdZRFZSMFBBUUgvQkFRREFnRUdNQkFHQ2lxR1NJYjNZMlFHQWdJRUFnVUFNQW9HQ0NxR1NNNDlCQU1EQTBjQU1FUUNJRlJPdFRFK1JRcEt4TlhFVEZzZjdNYzBoKzVJQXN4eG8vWDZvQ0MvYzMzcUFpQW1DNXJuNXlDT09FalRZNFIxSDFRY1FWaCtlVXdDbDEzTmJReFdDdXd4eEE9PVwiO1xuY29uc3QgTEVBRl9DRVJUX0ZPUl9JTlRFUk1FRElBVEVfQ0FfSU5WQUxJRF9PSURfQkFTRTY0X0VOQ09ERUQgPSBcIk1JSUJuekNDQVVhZ0F3SUJBZ0lCRGpBS0JnZ3Foa2pPUFFRREF6QkZNUXN3Q1FZRFZRUUdFd0pWVXpFTE1Ba0dBMVVFQ0F3Q1EwRXhFakFRQmdOVkJBY01DVU4xY0dWeWRHbHViekVWTUJNR0ExVUVDZ3dNU1c1MFpYSnRaV1JwWVhSbE1CNFhEVEl6TURFd05USXhNelkxT0ZvWERUTXpNREV3TVRJeE16WTFPRm93UFRFTE1Ba0dBMVVFQmhNQ1ZWTXhDekFKQmdOVkJBZ01Ba05CTVJJd0VBWURWUVFIREFsRGRYQmxjblJwYm04eERUQUxCZ05WQkFvTUJFeGxZV1l3V1RBVEJnY3Foa2pPUFFJQkJnZ3Foa2pPUFFNQkJ3TkNBQVRpdFlIRWFZVnVjOGc5QWpUT3dFck12R3lQeWtQYStwdXZUSThoSlRIWlpETEdhczJxWDErRXJ4Z1FUSmdWWHY3Nm5tTGhoUkpIK2oyNUFpQUk4aUdzb3k4d0xUQUpCZ05WSFJNRUFqQUFNQTRHQTFVZER3RUIvd1FFQXdJSGdEQVFCZ29xaGtpRzkyTmtCZ3NCQkFJRkFEQUtCZ2dxaGtqT1BRUURBd05IQURCRUFpQVVBcytnellPc0VYRHdRcXV2SFliY1Z5bXlOcUR0R3c5Qm5VRnAyWUx1dUFJZ1h4UTNJZTlZVTBjTXFrZWFGZCtseW8wYXN2OWV5ems2c3R3amVJZU90VFU9XCI7XG5jb25zdCBMRUFGX0NFUlRfSU5WQUxJRF9PSURfQkFTRTY0X0VOQ09ERUQgPSBcIk1JSUJvRENDQVVhZ0F3SUJBZ0lCRHpBS0JnZ3Foa2pPUFFRREF6QkZNUXN3Q1FZRFZRUUdFd0pWVXpFTE1Ba0dBMVVFQ0F3Q1EwRXhFakFRQmdOVkJBY01DVU4xY0dWeWRHbHViekVWTUJNR0ExVUVDZ3dNU1c1MFpYSnRaV1JwWVhSbE1CNFhEVEl6TURFd05USXhNemN6TVZvWERUTXpNREV3TVRJeE16Y3pNVm93UFRFTE1Ba0dBMVVFQmhNQ1ZWTXhDekFKQmdOVkJBZ01Ba05CTVJJd0VBWURWUVFIREFsRGRYQmxjblJwYm04eERUQUxCZ05WQkFvTUJFeGxZV1l3V1RBVEJnY3Foa2pPUFFJQkJnZ3Foa2pPUFFNQkJ3TkNBQVRpdFlIRWFZVnVjOGc5QWpUT3dFck12R3lQeWtQYStwdXZUSThoSlRIWlpETEdhczJxWDErRXJ4Z1FUSmdWWHY3Nm5tTGhoUkpIK2oyNUFpQUk4aUdzb3k4d0xUQUpCZ05WSFJNRUFqQUFNQTRHQTFVZER3RUIvd1FFQXdJSGdEQVFCZ29xaGtpRzkyTmtCZ3NDQkFJRkFEQUtCZ2dxaGtqT1BRUURBd05JQURCRkFpQWIrN1MzaS8vYlNHeTdza0pZOStENFZnY1FMS0ZlWWZJTVNyVUNtZHJGcXdJaEFJTVZ3ekQxUnJ4UFJ0SnlpT0NYTHlpYkl2d2NZK1ZTNzNIWWZrME85bGd6XCI7XG5cbmNvbnN0IExFQUZfQ0VSVF9QVUJMSUNfS0VZX0JBU0U2NF9FTkNPREVEID0gXCJNRmt3RXdZSEtvWkl6ajBDQVFZSUtvWkl6ajBEQVFjRFFnQUU0cldCeEdtRmJuUElQUUkwenNCS3pMeHNqOHBEMnZxYnIweVBJU1V4MldReXhtck5xbDlmaEs4WUVFeVlGVjcrK3A1aTRZVVNSL285dVFJZ0NQSWhyQT09XCI7XG5cbmNvbnN0IFJFQUxfQVBQTEVfUk9PVF9CQVNFNjRfRU5DT0RFRCA9IFwiTUlJQ1F6Q0NBY21nQXdJQkFnSUlMY1g4aU5MRlM1VXdDZ1lJS29aSXpqMEVBd013WnpFYk1Ca0dBMVVFQXd3U1FYQndiR1VnVW05dmRDQkRRU0F0SUVjek1TWXdKQVlEVlFRTERCMUJjSEJzWlNCRFpYSjBhV1pwWTJGMGFXOXVJRUYxZEdodmNtbDBlVEVUTUJFR0ExVUVDZ3dLUVhCd2JHVWdTVzVqTGpFTE1Ba0dBMVVFQmhNQ1ZWTXdIaGNOTVRRd05ETXdNVGd4T1RBMldoY05Nemt3TkRNd01UZ3hPVEEyV2pCbk1Sc3dHUVlEVlFRRERCSkJjSEJzWlNCU2IyOTBJRU5CSUMwZ1J6TXhKakFrQmdOVkJBc01IVUZ3Y0d4bElFTmxjblJwWm1sallYUnBiMjRnUVhWMGFHOXlhWFI1TVJNd0VRWURWUVFLREFwQmNIQnNaU0JKYm1NdU1Rc3dDUVlEVlFRR0V3SlZVekIyTUJBR0J5cUdTTTQ5QWdFR0JTdUJCQUFpQTJJQUJKanBMejFBY3FUdGt5SnlnUk1jM1JDVjhjV2pUbkhjRkJiWkR1V21CU3AzWkh0ZlRqalR1eHhFdFgvMUg3WXlZbDNKNllSYlR6QlBFVm9BL1ZoWURLWDFEeXhOQjBjVGRkcVhsNWR2TVZ6dEs1MTdJRHZZdVZUWlhwbWtPbEVLTWFOQ01FQXdIUVlEVlIwT0JCWUVGTHV3M3FGWU00aWFwSXFaM3I2OTY2L2F5eVNyTUE4R0ExVWRFd0VCL3dRRk1BTUJBZjh3RGdZRFZSMFBBUUgvQkFRREFnRUdNQW9HQ0NxR1NNNDlCQU1EQTJnQU1HVUNNUUNENmNIRUZsNGFYVFFZMmUzdjlHd09BRVpMdU4reVJoSEZELzNtZW95aHBtdk93Z1BVblBXVHhuUzRhdCtxSXhVQ01HMW1paERLMUEzVVQ4Mk5RejYwaW1PbE0yN2piZG9YdDJRZnlGTW0rWWhpZERrTEYxdkxVYWdNNkJnRDU2S3lLQT09XCI7XG5jb25zdCBSRUFMX0FQUExFX0lOVEVSTUVESUFURV9CQVNFNjRfRU5DT0RFRCA9IFwiTUlJREZqQ0NBcHlnQXdJQkFnSVVJc0doUndwMGMybnZVNFlTeWNhZlBUanpiTmN3Q2dZSUtvWkl6ajBFQXdNd1p6RWJNQmtHQTFVRUF3d1NRWEJ3YkdVZ1VtOXZkQ0JEUVNBdElFY3pNU1l3SkFZRFZRUUxEQjFCY0hCc1pTQkRaWEowYVdacFkyRjBhVzl1SUVGMWRHaHZjbWwwZVRFVE1CRUdBMVVFQ2d3S1FYQndiR1VnU1c1akxqRUxNQWtHQTFVRUJoTUNWVk13SGhjTk1qRXdNekUzTWpBek56RXdXaGNOTXpZd016RTVNREF3TURBd1dqQjFNVVF3UWdZRFZRUURERHRCY0hCc1pTQlhiM0pzWkhkcFpHVWdSR1YyWld4dmNHVnlJRkpsYkdGMGFXOXVjeUJEWlhKMGFXWnBZMkYwYVc5dUlFRjFkR2h2Y21sMGVURUxNQWtHQTFVRUN3d0NSell4RXpBUkJnTlZCQW9NQ2tGd2NHeGxJRWx1WXk0eEN6QUpCZ05WQkFZVEFsVlRNSFl3RUFZSEtvWkl6ajBDQVFZRks0RUVBQ0lEWWdBRWJzUUtDOTRQcmxXbVpYblhndHh6ZFZKTDhUMFNHWW5nRFJHcG5nbjNONlBUOEpNRWI3RkRpNGJCbVBoQ25aMy9zcTZQRi9jR2NLWFdzTDV2T3RlUmh5SjQ1eDNBU1A3Y09CK2FhbzkwZmNweFN2L0VaRmJuaUFiTmdaR2hJaHBJbzRINk1JSDNNQklHQTFVZEV3RUIvd1FJTUFZQkFmOENBUUF3SHdZRFZSMGpCQmd3Rm9BVXU3RGVvVmd6aUpxa2lwbmV2cjNycjlyTEpLc3dSZ1lJS3dZQkJRVUhBUUVFT2pBNE1EWUdDQ3NHQVFVRkJ6QUJoaXBvZEhSd09pOHZiMk56Y0M1aGNIQnNaUzVqYjIwdmIyTnpjREF6TFdGd2NHeGxjbTl2ZEdOaFp6TXdOd1lEVlIwZkJEQXdMakFzb0NxZ0tJWW1hSFIwY0RvdkwyTnliQzVoY0hCc1pTNWpiMjB2WVhCd2JHVnliMjkwWTJGbk15NWpjbXd3SFFZRFZSME9CQllFRkQ4dmxDTlIwMURKbWlnOTdiQjg1Yytsa0dLWk1BNEdBMVVkRHdFQi93UUVBd0lCQmpBUUJnb3Foa2lHOTJOa0JnSUJCQUlGQURBS0JnZ3Foa2pPUFFRREF3Tm9BREJsQWpCQVhoU3E1SXlLb2dNQ1B0dzQ5MEJhQjY3N0NhRUdKWHVmUUIvRXFaR2Q2Q1NqaUN0T251TVRiWFZYbXh4Y3hma0NNUURUU1B4YXJaWHZOcmt4VTNUa1VNSTMzeXp2RlZWUlQ0d3hXSkM5OTRPc2RjWjQrUkdOc1lEeVI1Z21kcjBuREdnPVwiO1xuY29uc3QgUkVBTF9BUFBMRV9TSUdOSU5HX0NFUlRJRklDQVRFX0JBU0U2NF9FTkNPREVEID0gXCJNSUlFTURDQ0E3YWdBd0lCQWdJUWFQb1BsZHZwU29FSDBsQnJqRFB2OWpBS0JnZ3Foa2pPUFFRREF6QjFNVVF3UWdZRFZRUURERHRCY0hCc1pTQlhiM0pzWkhkcFpHVWdSR1YyWld4dmNHVnlJRkpsYkdGMGFXOXVjeUJEWlhKMGFXWnBZMkYwYVc5dUlFRjFkR2h2Y21sMGVURUxNQWtHQTFVRUN3d0NSell4RXpBUkJnTlZCQW9NQ2tGd2NHeGxJRWx1WXk0eEN6QUpCZ05WQkFZVEFsVlRNQjRYRFRJeE1EZ3lOVEF5TlRBek5Gb1hEVEl6TURreU5EQXlOVEF6TTFvd2daSXhRREErQmdOVkJBTU1OMUJ5YjJRZ1JVTkRJRTFoWXlCQmNIQWdVM1J2Y21VZ1lXNWtJR2xVZFc1bGN5QlRkRzl5WlNCU1pXTmxhWEIwSUZOcFoyNXBibWN4TERBcUJnTlZCQXNNSTBGd2NHeGxJRmR2Y214a2QybGtaU0JFWlhabGJHOXdaWElnVW1Wc1lYUnBiMjV6TVJNd0VRWURWUVFLREFwQmNIQnNaU0JKYm1NdU1Rc3dDUVlEVlFRR0V3SlZVekJaTUJNR0J5cUdTTTQ5QWdFR0NDcUdTTTQ5QXdFSEEwSUFCT29UY2FQY3BlaXBOTDllUTA2dEN1N3BVY3dkQ1hkTjh2R3FhVWpkNThaOHRMeGlVQzBkQmVBK2V1TVlnZ2gxLzVpQWsrRk14VUZtQTJhMXI0YUNaOFNqZ2dJSU1JSUNCREFNQmdOVkhSTUJBZjhFQWpBQU1COEdBMVVkSXdRWU1CYUFGRDh2bENOUjAxREptaWc5N2JCODVjK2xrR0taTUhBR0NDc0dBUVVGQndFQkJHUXdZakF0QmdnckJnRUZCUWN3QW9ZaGFIUjBjRG92TDJObGNuUnpMbUZ3Y0d4bExtTnZiUzkzZDJSeVp6WXVaR1Z5TURFR0NDc0dBUVVGQnpBQmhpVm9kSFJ3T2k4dmIyTnpjQzVoY0hCc1pTNWpiMjB2YjJOemNEQXpMWGQzWkhKbk5qQXlNSUlCSGdZRFZSMGdCSUlCRlRDQ0FSRXdnZ0VOQmdvcWhraUc5Mk5rQlFZQk1JSCtNSUhEQmdnckJnRUZCUWNDQWpDQnRneUJzMUpsYkdsaGJtTmxJRzl1SUhSb2FYTWdZMlZ5ZEdsbWFXTmhkR1VnWW5rZ1lXNTVJSEJoY25SNUlHRnpjM1Z0WlhNZ1lXTmpaWEIwWVc1alpTQnZaaUIwYUdVZ2RHaGxiaUJoY0hCc2FXTmhZbXhsSUhOMFlXNWtZWEprSUhSbGNtMXpJR0Z1WkNCamIyNWthWFJwYjI1eklHOW1JSFZ6WlN3Z1kyVnlkR2xtYVdOaGRHVWdjRzlzYVdONUlHRnVaQ0JqWlhKMGFXWnBZMkYwYVc5dUlIQnlZV04wYVdObElITjBZWFJsYldWdWRITXVNRFlHQ0NzR0FRVUZCd0lCRmlwb2RIUndPaTh2ZDNkM0xtRndjR3hsTG1OdmJTOWpaWEowYVdacFkyRjBaV0YxZEdodmNtbDBlUzh3SFFZRFZSME9CQllFRkNPQ21NQnEvLzFMNWltdlZtcVgxb0NZZXFyTU1BNEdBMVVkRHdFQi93UUVBd0lIZ0RBUUJnb3Foa2lHOTJOa0Jnc0JCQUlGQURBS0JnZ3Foa2pPUFFRREF3Tm9BREJsQWpFQWw0SkI5R0pIaXhQMm51aWJ5VTFrM3dyaTVwc0dJeFBNRTA1c0ZLcTdoUXV6dmJleUJ1ODJGb3p6eG1ienBvZ29BakJMU0ZsMGRaV0lZbDJlalBWK0RpNWZCbktQdThteW1CUXRvRS9IMmJFUzBxQXM4Yk51ZVUzQ0JqamgxbHduRHNJPVwiO1xuXG5jb25zdCBFRkZFQ1RJVkVfREFURSA9IG5ldyBEYXRlKDE2ODEzMTI4NDYwMDApOyAvLyBBcHJpbCAyMDIzXG5jbGFzcyBTaWduZWRKV1RWZXJpZmllclRlc3QgZXh0ZW5kcyBTaWduZWREYXRhVmVyaWZpZXIge1xuICAgIGVmZmVjdGl2ZURhdGUgPSBFRkZFQ1RJVkVfREFURVxuICAgIGFzeW5jIHRlc3RWZXJpZnlDZXJ0aWZpY2F0ZUNoYWluKHRydXN0ZWRSb290czogWDUwOUNlcnRpZmljYXRlW10sIGxlYWY6IHN0cmluZywgaW50ZXJtZWRpYXRlOiBzdHJpbmcpOiBQcm9taXNlPEtleU9iamVjdD4ge1xuICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy52ZXJpZnlDZXJ0aWZpY2F0ZUNoYWluKHRydXN0ZWRSb290cywgbmV3IFg1MDlDZXJ0aWZpY2F0ZShCdWZmZXIuZnJvbShsZWFmLCAnYmFzZTY0JykpLCBuZXcgWDUwOUNlcnRpZmljYXRlKEJ1ZmZlci5mcm9tKGludGVybWVkaWF0ZSwgJ2Jhc2U2NCcpKSwgdGhpcy5lZmZlY3RpdmVEYXRlKVxuICAgIH1cblxuICAgIGdldFJvb3RDZXJ0aWZpY2F0ZXMoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnJvb3RDZXJ0aWZpY2F0ZXNcbiAgICB9IFxufVxuXG5kZXNjcmliZShcIkNoYWluIFZlcmlmaWNhdGlvbiBDaGVja3NcIiwgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgdmFsaWRhdGUgYSBjaGFpbiB3aXRob3V0IE9DU1AnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHZlcmlmaWVyID0gbmV3IFNpZ25lZEpXVFZlcmlmaWVyVGVzdChbQnVmZmVyLmZyb20oUk9PVF9DQV9CQVNFNjRfRU5DT0RFRCwgJ2Jhc2U2NCcpXSwgZmFsc2UsIEVudmlyb25tZW50LlBST0RVQ1RJT04sIFwiY29tLmV4YW1wbGVcIiwgMTIzNCk7XG4gICAgICAgIGNvbnN0IHB1YmxpY0tleSA9IGF3YWl0IHZlcmlmaWVyLnRlc3RWZXJpZnlDZXJ0aWZpY2F0ZUNoYWluKHZlcmlmaWVyLmdldFJvb3RDZXJ0aWZpY2F0ZXMoKSwgTEVBRl9DRVJUX0JBU0U2NF9FTkNPREVELCBJTlRFUk1FRElBVEVfQ0FfQkFTRTY0X0VOQ09ERUQpXG4gICAgICAgIGV4cGVjdChCdWZmZXIuZnJvbShMRUFGX0NFUlRfUFVCTElDX0tFWV9CQVNFNjRfRU5DT0RFRCwgJ2Jhc2U2NCcpKS50b01hdGNoT2JqZWN0KHB1YmxpY0tleS5leHBvcnQoe1xuICAgICAgICAgICAgdHlwZTogJ3Nwa2knLFxuICAgICAgICAgICAgZm9ybWF0OiAnZGVyJ1xuICAgICAgICB9KSlcbiAgICB9KVxuXG4gICAgaXQoJ3Nob3VsZCBmYWlsIHRvIHZhbGlkYXRlIGEgY2hhaW4gd2l0aCBhbiBpbnZhbGlkIGludGVybWVkaWF0ZSBPSUQnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHZlcmlmaWVyID0gbmV3IFNpZ25lZEpXVFZlcmlmaWVyVGVzdChbQnVmZmVyLmZyb20oUk9PVF9DQV9CQVNFNjRfRU5DT0RFRCwgJ2Jhc2U2NCcpXSwgZmFsc2UsIEVudmlyb25tZW50LlBST0RVQ1RJT04sIFwiY29tLmV4YW1wbGVcIiwgMTIzNCk7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBhd2FpdCB2ZXJpZmllci50ZXN0VmVyaWZ5Q2VydGlmaWNhdGVDaGFpbih2ZXJpZmllci5nZXRSb290Q2VydGlmaWNhdGVzKCksIExFQUZfQ0VSVF9GT1JfSU5URVJNRURJQVRFX0NBX0lOVkFMSURfT0lEX0JBU0U2NF9FTkNPREVELCBJTlRFUk1FRElBVEVfQ0FfSU5WQUxJRF9PSURfQkFTRTY0X0VOQ09ERUQpXG4gICAgICAgICAgICBhc3NlcnQoZmFsc2UpXG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIGV4cGVjdChlKS50b0JlSW5zdGFuY2VPZihWZXJpZmljYXRpb25FeGNlcHRpb24pXG4gICAgICAgICAgICBleHBlY3QoKGUgYXMgVmVyaWZpY2F0aW9uRXhjZXB0aW9uKS5zdGF0dXMpLnRvRXF1YWwoVmVyaWZpY2F0aW9uU3RhdHVzLlZFUklGSUNBVElPTl9GQUlMVVJFKVxuICAgICAgICB9XG4gICAgfSlcblxuICAgIGl0KCdzaG91bGQgZmFpbCB0byB2YWxpZGF0ZSBhIGNoYWluIHdpdGggYW4gaW52YWxpZCBsZWFmIE9JRCcsIGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgdmVyaWZpZXIgPSBuZXcgU2lnbmVkSldUVmVyaWZpZXJUZXN0KFtCdWZmZXIuZnJvbShST09UX0NBX0JBU0U2NF9FTkNPREVELCAnYmFzZTY0JyldLCBmYWxzZSwgRW52aXJvbm1lbnQuUFJPRFVDVElPTiwgXCJjb20uZXhhbXBsZVwiLCAxMjM0KTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGF3YWl0IHZlcmlmaWVyLnRlc3RWZXJpZnlDZXJ0aWZpY2F0ZUNoYWluKHZlcmlmaWVyLmdldFJvb3RDZXJ0aWZpY2F0ZXMoKSwgTEVBRl9DRVJUX0lOVkFMSURfT0lEX0JBU0U2NF9FTkNPREVELCBJTlRFUk1FRElBVEVfQ0FfQkFTRTY0X0VOQ09ERUQpXG4gICAgICAgICAgICBhc3NlcnQoZmFsc2UpXG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIGV4cGVjdChlKS50b0JlSW5zdGFuY2VPZihWZXJpZmljYXRpb25FeGNlcHRpb24pXG4gICAgICAgICAgICBleHBlY3QoKGUgYXMgVmVyaWZpY2F0aW9uRXhjZXB0aW9uKS5zdGF0dXMpLnRvRXF1YWwoVmVyaWZpY2F0aW9uU3RhdHVzLlZFUklGSUNBVElPTl9GQUlMVVJFKVxuICAgICAgICB9XG4gICAgfSlcblxuICAgIGl0KCdzaG91bGQgZmFpbCB0byB2YWxpZGF0ZSBhIGNoYWluIHdpdGggZW1wdHkgcm9vdCBjZXJ0aWZpY2F0ZSBhcnJheScsIGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgdmVyaWZpZXIgPSBuZXcgU2lnbmVkSldUVmVyaWZpZXJUZXN0KFtdLCBmYWxzZSwgRW52aXJvbm1lbnQuUFJPRFVDVElPTiwgXCJjb20uZXhhbXBsZVwiLCAxMjM0KTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGF3YWl0IHZlcmlmaWVyLnRlc3RWZXJpZnlDZXJ0aWZpY2F0ZUNoYWluKHZlcmlmaWVyLmdldFJvb3RDZXJ0aWZpY2F0ZXMoKSwgTEVBRl9DRVJUX0JBU0U2NF9FTkNPREVELCBJTlRFUk1FRElBVEVfQ0FfQkFTRTY0X0VOQ09ERUQpXG4gICAgICAgICAgICBhc3NlcnQoZmFsc2UpXG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIGV4cGVjdChlKS50b0JlSW5zdGFuY2VPZihWZXJpZmljYXRpb25FeGNlcHRpb24pXG4gICAgICAgICAgICBleHBlY3QoKGUgYXMgVmVyaWZpY2F0aW9uRXhjZXB0aW9uKS5zdGF0dXMpLnRvRXF1YWwoVmVyaWZpY2F0aW9uU3RhdHVzLlZFUklGSUNBVElPTl9GQUlMVVJFKVxuICAgICAgICB9XG4gICAgfSlcblxuICAgIGl0KCdzaG91bGQgZmFpbCB0byB2YWxpZGF0ZSBhIGNoYWluIHdpdGggYW4gZXhwaXJlZCBjaGFpbicsIGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgdmVyaWZpZXIgPSBuZXcgU2lnbmVkSldUVmVyaWZpZXJUZXN0KFtCdWZmZXIuZnJvbShST09UX0NBX0JBU0U2NF9FTkNPREVELCAnYmFzZTY0JyldLCBmYWxzZSwgRW52aXJvbm1lbnQuUFJPRFVDVElPTiwgXCJjb20uZXhhbXBsZVwiLCAxMjM0KTtcbiAgICAgICAgdmVyaWZpZXIuZWZmZWN0aXZlRGF0ZSA9IG5ldyBEYXRlKDIyODA5NDY4NDYwMDApXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBhd2FpdCB2ZXJpZmllci50ZXN0VmVyaWZ5Q2VydGlmaWNhdGVDaGFpbih2ZXJpZmllci5nZXRSb290Q2VydGlmaWNhdGVzKCksIExFQUZfQ0VSVF9CQVNFNjRfRU5DT0RFRCwgSU5URVJNRURJQVRFX0NBX0JBU0U2NF9FTkNPREVEKVxuICAgICAgICAgICAgYXNzZXJ0KGZhbHNlKVxuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICBleHBlY3QoZSkudG9CZUluc3RhbmNlT2YoVmVyaWZpY2F0aW9uRXhjZXB0aW9uKVxuICAgICAgICAgICAgZXhwZWN0KChlIGFzIFZlcmlmaWNhdGlvbkV4Y2VwdGlvbikuc3RhdHVzKS50b0VxdWFsKFZlcmlmaWNhdGlvblN0YXR1cy5JTlZBTElEX0NFUlRJRklDQVRFKVxuICAgICAgICB9XG4gICAgfSlcblxuICAgIGl0KCdzaG91bGQgdmFsaWRhdGUgYSByZWFsIGNoYWluIHdpdGggT0NTUCcsIGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgdmVyaWZpZXIgPSBuZXcgU2lnbmVkSldUVmVyaWZpZXJUZXN0KFtCdWZmZXIuZnJvbShSRUFMX0FQUExFX1JPT1RfQkFTRTY0X0VOQ09ERUQsICdiYXNlNjQnKV0sIHRydWUsIEVudmlyb25tZW50LlBST0RVQ1RJT04sIFwiY29tLmV4YW1wbGVcIiwgMTIzNCk7XG4gICAgICAgIGF3YWl0IHZlcmlmaWVyLnRlc3RWZXJpZnlDZXJ0aWZpY2F0ZUNoYWluKHZlcmlmaWVyLmdldFJvb3RDZXJ0aWZpY2F0ZXMoKSwgUkVBTF9BUFBMRV9TSUdOSU5HX0NFUlRJRklDQVRFX0JBU0U2NF9FTkNPREVELCBSRUFMX0FQUExFX0lOVEVSTUVESUFURV9CQVNFNjRfRU5DT0RFRClcbiAgICB9KVxuXG4gICAgaXQoJ3Nob3VsZCBmYWlsIHRvIHZhbGlkYXRlIGEgY2hhaW4gd2l0aCBtaXNtYXRjaGVkIHJvb3QgY2VydGlmaWNhdGVzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCB2ZXJpZmllciA9IG5ldyBTaWduZWRKV1RWZXJpZmllclRlc3QoW0J1ZmZlci5mcm9tKFJFQUxfQVBQTEVfUk9PVF9CQVNFNjRfRU5DT0RFRCwgJ2Jhc2U2NCcpXSwgZmFsc2UsIEVudmlyb25tZW50LlBST0RVQ1RJT04sIFwiY29tLmV4YW1wbGVcIiwgMTIzNCk7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBhd2FpdCB2ZXJpZmllci50ZXN0VmVyaWZ5Q2VydGlmaWNhdGVDaGFpbih2ZXJpZmllci5nZXRSb290Q2VydGlmaWNhdGVzKCksIExFQUZfQ0VSVF9CQVNFNjRfRU5DT0RFRCwgSU5URVJNRURJQVRFX0NBX0JBU0U2NF9FTkNPREVEKVxuICAgICAgICAgICAgYXNzZXJ0KGZhbHNlKVxuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICBleHBlY3QoZSkudG9CZUluc3RhbmNlT2YoVmVyaWZpY2F0aW9uRXhjZXB0aW9uKVxuICAgICAgICAgICAgZXhwZWN0KChlIGFzIFZlcmlmaWNhdGlvbkV4Y2VwdGlvbikuc3RhdHVzKS50b0VxdWFsKFZlcmlmaWNhdGlvblN0YXR1cy5WRVJJRklDQVRJT05fRkFJTFVSRSlcbiAgICAgICAgICAgIHJldHVyblxuICAgICAgICB9XG4gICAgfSlcblxuICAgIGl0KCdzaG91bGQgZmFpbCB0byB2YWxpZGF0ZSBhIGNoYWluIHdpdGggaW52YWxpZCByb290IGNlcnRpZmljYXRlcycsIGFzeW5jICgpID0+IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IHZlcmlmaWVyID0gbmV3IFNpZ25lZEpXVFZlcmlmaWVyVGVzdChbQnVmZmVyLmZyb20oXCJhYmNcIiwgXCJ1dGYtOFwiKV0sIGZhbHNlLCBFbnZpcm9ubWVudC5QUk9EVUNUSU9OLCBcImNvbS5leGFtcGxlXCIsIDEyMzQpO1xuICAgICAgICAgICAgYXdhaXQgdmVyaWZpZXIudGVzdFZlcmlmeUNlcnRpZmljYXRlQ2hhaW4odmVyaWZpZXIuZ2V0Um9vdENlcnRpZmljYXRlcygpLCBMRUFGX0NFUlRfQkFTRTY0X0VOQ09ERUQsIElOVEVSTUVESUFURV9DQV9CQVNFNjRfRU5DT0RFRClcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgcmV0dXJuXG4gICAgICAgIH1cbiAgICAgICAgYXNzZXJ0KGZhbHNlKVxuICAgIH0pXG59KVxuXG5kZXNjcmliZShcIkRlY29kaW5nIGNoZWNrc1wiLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBmYWlsIHRvIHZlcmlmeSB3aXRoIGEgbWlzc2luZyB4NWMgaGVhZGVyJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCB2ZXJpZmllciA9IGdldFNpZ25lZFBheWxvYWRWZXJpZmllcldpdGhEZWZhdWx0QXBwQXBwbGVJZChFbnZpcm9ubWVudC5QUk9EVUNUSU9OLCBcImNvbS5leGFtcGxlXCIpXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCBtaXNzaW5nWDVDSGVhZGVyQ2xhaW0gPSByZWFkRmlsZSgndGVzdHMvcmVzb3VyY2VzL21vY2tfc2lnbmVkX2RhdGEvbWlzc2luZ1g1Q0hlYWRlckNsYWltJylcbiAgICAgICAgICAgIGF3YWl0IHZlcmlmaWVyLnZlcmlmeUFuZERlY29kZU5vdGlmaWNhdGlvbihtaXNzaW5nWDVDSGVhZGVyQ2xhaW0pXG4gICAgICAgICAgICBhc3NlcnQoZmFsc2UpXG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIGV4cGVjdChlKS50b0JlSW5zdGFuY2VPZihWZXJpZmljYXRpb25FeGNlcHRpb24pXG4gICAgICAgICAgICBleHBlY3QoKGUgYXMgVmVyaWZpY2F0aW9uRXhjZXB0aW9uKS5zdGF0dXMpLnRvRXF1YWwoVmVyaWZpY2F0aW9uU3RhdHVzLklOVkFMSURfQ0VSVElGSUNBVEUpXG4gICAgICAgIH1cbiAgICB9KVxuXG4gICAgaXQoJ3Nob3VsZCBmYWlsIHRvIHZlcmlmeSB3aXRoIGFuIGludmFsaWQgYnVuZGxlIGlkJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCB2ZXJpZmllciA9IGdldFNpZ25lZFBheWxvYWRWZXJpZmllcldpdGhEZWZhdWx0QXBwQXBwbGVJZChFbnZpcm9ubWVudC5TQU5EQk9YLCBcImNvbS5leGFtcGxlXCIpXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCB3cm9uZ0J1bmRlbElkID0gcmVhZEZpbGUoJ3Rlc3RzL3Jlc291cmNlcy9tb2NrX3NpZ25lZF9kYXRhL3dyb25nQnVuZGxlSWQnKVxuICAgICAgICAgICAgYXdhaXQgdmVyaWZpZXIudmVyaWZ5QW5kRGVjb2RlTm90aWZpY2F0aW9uKHdyb25nQnVuZGVsSWQpXG4gICAgICAgICAgICBhc3NlcnQoZmFsc2UpXG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIGV4cGVjdChlKS50b0JlSW5zdGFuY2VPZihWZXJpZmljYXRpb25FeGNlcHRpb24pXG4gICAgICAgICAgICBleHBlY3QoKGUgYXMgVmVyaWZpY2F0aW9uRXhjZXB0aW9uKS5zdGF0dXMpLnRvRXF1YWwoVmVyaWZpY2F0aW9uU3RhdHVzLklOVkFMSURfQVBQX0lERU5USUZJRVIpXG4gICAgICAgIH1cbiAgICB9KVxuXG4gICAgaXQoJ3Nob3VsZCBmYWlsIHRvIHZlcmlmeSB3aXRoIGFuIGludmFsaWQgYnVuZGxlIGlkIGZvciB0cmFuc2FjdGlvbicsIGFzeW5jICgpID0+IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IHZlcmlmaWVyID0gZ2V0U2lnbmVkUGF5bG9hZFZlcmlmaWVyV2l0aERlZmF1bHRBcHBBcHBsZUlkKEVudmlyb25tZW50LlNBTkRCT1gsIFwiY29tLmV4YW1wbGUueFwiKVxuICAgICAgICAgICAgY29uc3QgdHJhbnNhY3Rpb25JbmZvID0gcmVhZEZpbGUoJ3Rlc3RzL3Jlc291cmNlcy9tb2NrX3NpZ25lZF9kYXRhL3RyYW5zYWN0aW9uSW5mbycpXG4gICAgICAgICAgICBhd2FpdCB2ZXJpZmllci52ZXJpZnlBbmREZWNvZGVUcmFuc2FjdGlvbih0cmFuc2FjdGlvbkluZm8pXG4gICAgICAgICAgICBhc3NlcnQoZmFsc2UpXG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIGV4cGVjdChlKS50b0JlSW5zdGFuY2VPZihWZXJpZmljYXRpb25FeGNlcHRpb24pXG4gICAgICAgICAgICBleHBlY3QoKGUgYXMgVmVyaWZpY2F0aW9uRXhjZXB0aW9uKS5zdGF0dXMpLnRvRXF1YWwoVmVyaWZpY2F0aW9uU3RhdHVzLklOVkFMSURfQVBQX0lERU5USUZJRVIpXG4gICAgICAgIH1cbiAgICB9KVxuXG4gICAgaXQoJ3Nob3VsZCBmYWlsIHRvIHZlcmlmeSB3aXRoIGFuIGludmFsaWQgZW52aXJvbm1lbnQnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCB2ZXJpZmllciA9IGdldFNpZ25lZFBheWxvYWRWZXJpZmllcldpdGhEZWZhdWx0QXBwQXBwbGVJZChFbnZpcm9ubWVudC5QUk9EVUNUSU9OLCBcImNvbS5leGFtcGxlXCIpXG4gICAgICAgICAgICBjb25zdCB0ZXN0Tm90aWZpY2F0aW9uID0gcmVhZEZpbGUoJ3Rlc3RzL3Jlc291cmNlcy9tb2NrX3NpZ25lZF9kYXRhL3Rlc3ROb3RpZmljYXRpb24nKVxuICAgICAgICAgICAgY29uc3Qgbm90aWZpY2F0aW9uID0gYXdhaXQgdmVyaWZpZXIudmVyaWZ5QW5kRGVjb2RlTm90aWZpY2F0aW9uKHRlc3ROb3RpZmljYXRpb24pXG4gICAgICAgICAgICBhd2FpdCB2ZXJpZmllci52ZXJpZnlBbmREZWNvZGVOb3RpZmljYXRpb24odGVzdE5vdGlmaWNhdGlvbilcbiAgICAgICAgICAgIGFzc2VydChmYWxzZSlcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgZXhwZWN0KGUpLnRvQmVJbnN0YW5jZU9mKFZlcmlmaWNhdGlvbkV4Y2VwdGlvbilcbiAgICAgICAgICAgIGV4cGVjdCgoZSBhcyBWZXJpZmljYXRpb25FeGNlcHRpb24pLnN0YXR1cykudG9FcXVhbChWZXJpZmljYXRpb25TdGF0dXMuSU5WQUxJRF9FTlZJUk9OTUVOVClcbiAgICAgICAgfVxuICAgIH0pXG5cbiAgICBpdCgnc2hvdWxkIGZhaWwgdG8gdmVyaWZ5IHdpdGggYSBtYWxmb3JtZWQgSldUIHdpdGggdG9vIG1hbnkgcGFydHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHZlcmlmaWVyID0gZ2V0U2lnbmVkUGF5bG9hZFZlcmlmaWVyV2l0aERlZmF1bHRBcHBBcHBsZUlkKEVudmlyb25tZW50LlNBTkRCT1gsIFwiY29tLmV4YW1wbGVcIilcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGF3YWl0IHZlcmlmaWVyLnZlcmlmeUFuZERlY29kZU5vdGlmaWNhdGlvbihcImEuYi5jLmRcIilcbiAgICAgICAgICAgIGFzc2VydChmYWxzZSlcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgZXhwZWN0KGUpLnRvQmVJbnN0YW5jZU9mKFZlcmlmaWNhdGlvbkV4Y2VwdGlvbilcbiAgICAgICAgICAgIGV4cGVjdCgoZSBhcyBWZXJpZmljYXRpb25FeGNlcHRpb24pLnN0YXR1cykudG9FcXVhbChWZXJpZmljYXRpb25TdGF0dXMuVkVSSUZJQ0FUSU9OX0ZBSUxVUkUpXG4gICAgICAgIH1cbiAgICB9KVxuXG4gICAgaXQoJ3Nob3VsZCBmYWlsIHRvIHZlcmlmeSB3aXRoIGEgbWFsZm9ybWVkIEpXVCcsIGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgdmVyaWZpZXIgPSBnZXRTaWduZWRQYXlsb2FkVmVyaWZpZXJXaXRoRGVmYXVsdEFwcEFwcGxlSWQoRW52aXJvbm1lbnQuU0FOREJPWCwgXCJjb20uZXhhbXBsZVwiKVxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgYXdhaXQgdmVyaWZpZXIudmVyaWZ5QW5kRGVjb2RlTm90aWZpY2F0aW9uKFwiYS5iLmNcIilcbiAgICAgICAgICAgIGFzc2VydChmYWxzZSlcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgZXhwZWN0KGUpLnRvQmVJbnN0YW5jZU9mKFZlcmlmaWNhdGlvbkV4Y2VwdGlvbilcbiAgICAgICAgICAgIGV4cGVjdCgoZSBhcyBWZXJpZmljYXRpb25FeGNlcHRpb24pLnN0YXR1cykudG9FcXVhbChWZXJpZmljYXRpb25TdGF0dXMuVkVSSUZJQ0FUSU9OX0ZBSUxVUkUpXG4gICAgICAgIH1cbiAgICB9KVxuXG4gICAgaXQoJ3Nob3VsZCB2ZXJpZnkgYW5kIGRlY29kZSBhIHZhbGlkIG5vdGlmaWNhdGlvbicsIGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgdmVyaWZpZXIgPSBnZXRTaWduZWRQYXlsb2FkVmVyaWZpZXJXaXRoRGVmYXVsdEFwcEFwcGxlSWQoRW52aXJvbm1lbnQuU0FOREJPWCwgXCJjb20uZXhhbXBsZVwiKVxuICAgICAgICBjb25zdCB0ZXN0Tm90aWZpY2F0aW9uID0gcmVhZEZpbGUoJ3Rlc3RzL3Jlc291cmNlcy9tb2NrX3NpZ25lZF9kYXRhL3Rlc3ROb3RpZmljYXRpb24nKVxuICAgICAgICBjb25zdCBub3RpZmljYXRpb24gPSBhd2FpdCB2ZXJpZmllci52ZXJpZnlBbmREZWNvZGVOb3RpZmljYXRpb24odGVzdE5vdGlmaWNhdGlvbilcbiAgICAgICAgZXhwZWN0KG5vdGlmaWNhdGlvbi5ub3RpZmljYXRpb25UeXBlKS50b0VxdWFsKFwiVEVTVFwiKVxuICAgIH0pXG5cbiAgICBpdCgnc2hvdWxkIHZlcmlmeSBhbmQgZGVjb2RlIGEgdmFsaWQgcmVuZXdhbCBpbmZvJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCB2ZXJpZmllciA9Z2V0U2lnbmVkUGF5bG9hZFZlcmlmaWVyV2l0aERlZmF1bHRBcHBBcHBsZUlkKEVudmlyb25tZW50LlNBTkRCT1gsIFwiY29tLmV4YW1wbGVcIilcblxuICAgICAgICBjb25zdCByZW5ld2FsSW5mbyA9IHJlYWRGaWxlKCd0ZXN0cy9yZXNvdXJjZXMvbW9ja19zaWduZWRfZGF0YS9yZW5ld2FsSW5mbycpXG4gICAgICAgIGNvbnN0IG5vdGlmaWNhdGlvbiA9IGF3YWl0IHZlcmlmaWVyLnZlcmlmeUFuZERlY29kZVJlbmV3YWxJbmZvKHJlbmV3YWxJbmZvKVxuICAgICAgICBleHBlY3Qobm90aWZpY2F0aW9uLmVudmlyb25tZW50KS50b0VxdWFsKEVudmlyb25tZW50LlNBTkRCT1gpXG4gICAgfSlcblxuICAgIGl0KCdzaG91bGQgdmVyaWZ5IGFuZCBkZWNvZGUgYSB2YWxpZCB0cmFuc2FjdGlvbiBpbmZvJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCB2ZXJpZmllciA9IGdldFNpZ25lZFBheWxvYWRWZXJpZmllcldpdGhEZWZhdWx0QXBwQXBwbGVJZChFbnZpcm9ubWVudC5TQU5EQk9YLCBcImNvbS5leGFtcGxlXCIpXG5cbiAgICAgICAgY29uc3QgdHJhbnNhY3Rpb25JbmZvID0gcmVhZEZpbGUoJ3Rlc3RzL3Jlc291cmNlcy9tb2NrX3NpZ25lZF9kYXRhL3RyYW5zYWN0aW9uSW5mbycpXG4gICAgICAgIGNvbnN0IG5vdGlmaWNhdGlvbiA9IGF3YWl0IHZlcmlmaWVyLnZlcmlmeUFuZERlY29kZVJlbmV3YWxJbmZvKHRyYW5zYWN0aW9uSW5mbylcbiAgICAgICAgZXhwZWN0KG5vdGlmaWNhdGlvbi5lbnZpcm9ubWVudCkudG9FcXVhbChFbnZpcm9ubWVudC5TQU5EQk9YKVxuICAgIH0pXG59KTsiXX0=